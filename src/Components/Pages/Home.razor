@page "/"
@inject MenuShopper.Services.DataService DataService

<PageTitle>Home</PageTitle>

<MudText Typo="Typo.h4" GutterBottom="true">Menu Shopper</MudText>
<MudText Typo="Typo.body1" Class="mb-6">Plan meals and generate shopping lists.</MudText>

<MudGrid Spacing="2">
    <MudItem xs="12" sm="6" md="3">
        <MudPaper Class="pa-4">
            <MudText Typo="Typo.subtitle2">Total Meals</MudText>
            <MudText Typo="Typo.h5">@_totalMeals</MudText>
        </MudPaper>
    </MudItem>
    <MudItem xs="12" sm="6" md="3">
        <MudPaper Class="pa-4">
            <MudText Typo="Typo.subtitle2">Favourites</MudText>
            <MudText Typo="Typo.h5">@_favouriteMeals</MudText>
        </MudPaper>
    </MudItem>
    <MudItem xs="12" sm="6" md="3">
        <MudPaper Class="pa-4">
            <MudText Typo="Typo.subtitle2">Dairy Meals</MudText>
            <MudText Typo="Typo.h5">@_dairyMeals</MudText>
        </MudPaper>
    </MudItem>
    <MudItem xs="12" sm="6" md="3">
        <MudPaper Class="pa-4">
            <MudText Typo="Typo.subtitle2">Unique Ingredients</MudText>
            <MudText Typo="Typo.h5">@_uniqueIngredients</MudText>
        </MudPaper>
    </MudItem>
</MudGrid>

@code {
    private int _totalMeals;
    private int _favouriteMeals;
    private int _dairyMeals;
    private int _uniqueIngredients;

    protected override async Task OnInitializedAsync()
    {
        await DataService.LoadMealsAsync();
        var meals = DataService.GetMeals();
        _totalMeals = meals.Count;
        _favouriteMeals = meals.Count(m => m.IsFavourite);
        _dairyMeals = meals.Count(m => m.IsDairy);
        _uniqueIngredients = meals.SelectMany(m => m.Ingredients)
            .Where(i => !string.IsNullOrWhiteSpace(i))
            .Distinct(StringComparer.OrdinalIgnoreCase)
            .Count();
    }
}
